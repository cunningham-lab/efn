\def\xnode{\node[align=left, draw,thick,circle,black,minimum size=1.0cm,fill=gray!20!white]}
\def\znode{\node[align=left, draw,thick,circle,black,minimum size=1.0cm,fill=white]}


\begin{tikzpicture}[>=triangle 45, triangle/.style = {fill=white, regular polygon, regular polygon sides=3 }]%,transform canvas={scale=0.8}]

% panel A
\node (A) at (-6.2, 0.4) {{\bf A}};

  \xnode (x) at (-4.0,-2.0) {{\bf $x$}};
 \znode (z) at (-4.0,0.0) {$z$};
 \node (a0) at (-5.5,0.0) {$\alpha_0$};
 \node (a) at (-5.5,-2.0) {$\gamma$};
  
 \draw[thick,->] (z)--(x);
\draw[thick,->] (a0)--(z);
\draw[thick,->] (a)--(x);
 \node[rectangle,draw=black, thick, rounded corners, fit=(x),inner sep=3.5mm](plate1) {};
 
 % Dir to the right
 \node (dz)[align=left] at (-1.7,0.0) {$z \sim Dir(\alpha_0)$};
 \node (dx)[align=left] at (-1.5,-2.0) {$x_i | z \sim Dir(\gamma z)$};
\node (zx) at (-3.0,-4.5) {\footnotesize $p(z | X) \propto \exp\left\{ \begin{bmatrix} \alpha_0 \\ \sum \log x_i \end{bmatrix}^\top \begin{bmatrix} z \\ \log z \end{bmatrix} \right\} $};
 \node (post) at (-3.0,-3.0) {};
\draw[thick,dashed,->] (post)--(zx); 
 
% panel B
\node (B) at (0.0, 0.4) {{\bf B}};
 
 \node[triangle, draw=black, thick,inner sep=3mm](d0) at (2.7,-0.4) {}; 
 \node[triangle, draw=black, thick,inner sep=3mm](d1) at (1,-2.3) {}; 
  \node[triangle, draw=black, thick,inner sep=3mm](d2) at (2.7,-2.3) {}; 
  \node (dt) at (3.5,-2.1){...};
   \node[triangle, draw=black, thick,inner sep=3mm](d3) at (4.4,-2.3) {};  

 \node[triangle, draw=black, thick,inner sep=3mm](dp1) at (1,-4.7) {}; 
  \node[triangle, draw=black, thick,inner sep=3mm](dp2) at (2.7,-4.7) {}; 
  \node (dpt) at (3.5,-4.3){...};
   \node[triangle, draw=black, thick,inner sep=3mm](dp3) at (4.4,-4.7) {};  

 \node (p1) at (1.0,-2.8) {};
  \node (p2) at (2.7,-2.8) {};
   \node (p3) at (4.4,-2.8) {};
\draw[thick,dashed,->] (p1)--(dp1); 
\draw[thick,dashed,->] (p2)--(dp2); 
\draw[thick,dashed,->] (p3)--(dp3); 

\draw[thick,->] (d0.south)--(d1.north); 
\draw[thick,->] (d0.south)--(d2.north); 
\draw[thick,->] (d0.south)--(d3.north); 


% panel C
\node (C) at (5.4, 0.4) {{\bf C}};

\node (w) at (6.9,0.0) {$w \sim \mathcal{N}(0,I)$};

\node (nf1) at (6.9, -1.1)  {};
\draw[draw=black,thick] (5.8, -1.2) rectangle ++(2.2,0.2);
\draw[thick,->] (w.south)--(nf1.north);

\node (nf2) at (6.9, -2.1)  {};
\draw[draw=black,thick] (5.8, -2.2) rectangle ++(2.2,0.2);
\draw[thick,->] (nf1.south)--(nf2.north);

\node (nf3) at (6.9, -3.1)  {};
\draw[draw=black,thick] (5.8, -3.2) rectangle ++(2.2,0.2);
\draw[thick,dotted] (nf2.south)--(nf3.north);

\node (nf4) at (6.9, -4.4)  {$z \sim q_\phi(z;\eta)$};
\draw[thick,->] (nf3.south)--(nf4.north);

% now the theta of eta network.
\node (eta) at (11, -2.1) {$\eta$};

\node (te1) at (10.3, -2.1)  {};
\draw[draw=black,thick] (10.2, -3.2) rectangle ++(0.2,2.2);
\draw[thick,->] (eta)--(te1);

\node (te2) at (9.7, -2.1)  {};
\draw[draw=black,thick] (9.6, -3.2) rectangle ++(0.2,2.2);
\draw[thick,->] (te1)--(te2);

\node (te3) at (9.1, -2.1)  {};
\draw[draw=black,thick] (9, -3.2) rectangle ++(0.2,2.2);
\draw[thick,dotted] (te2)--(te3);


% connect networks
\node (nf1r) at (8, -1.1)  {};
\node (nf2r) at (8, -2.1)  {};
\node (nf3r) at (8, -3.1)  {};
\draw[thick,->] (te3)--(nf1r); 
\draw[thick,->] (te3)--(nf2r); 
\draw[thick,->] (te3)--(nf3r); 

\node (tpe) at (7.8, -2.5) {$\theta_{\phi} (\eta)$};
\node (phi) at (9.7, -3.5) {$\phi$};


% \xnode (x) at (-4.0,-2.0) {$x$};
% \znode (z) at (-4.0,0.0) {$z$};
% \node (a) at (-5.0,-2.0) {$\gamma$};
% \node (a0) at (-5.0,0.0) {$\alpha_0$};
%
%  \draw[thick] (x)--(z);
%  \draw[thick] (a0)--(z); 
%  \draw[thick] (a)--(x);
%  
  
%  \gmnode (X) at (0,0) {};
%  \node[align=center] at (X)        {$\sigma\left(\sum_i \!w_{ij}^0 x_{i}^0 \!+\! b_j^1\right)$};
%  \node (X1) at (-3.0,-2.0) {$x_{3}^0$};
%  \node (X2) at (-3.0,0) {$x_{2}^0$};
%  \node (X3) at (-3.0,2.0) {$x_{1}^0$};
%  \node[circle,fill=black] (X4) at (2.5,0) {};
%  \node (X5) at (4.0,-2.0) {...};
%  \node (X6) at (4.0,0.0) {...};
%  \node (X7) at (4.0,2.0) {...};
%  \node (X8) at (1,-2.5) {Neural unit};
%  
%  \draw[thick] (X)--(X1) node[pos=0.8,scale=0.2,label=right:{$w_{3j}^0$}] {};
%  \draw[thick] (X)--(X2) node[pos=0.5,scale=0.2,label=above:{$w_{2j}^0$}] {};
%  \draw[thick] (X)--(X3) node[pos=0.8,scale=0.2,label=right:{$w_{1j}^0$}] {};
%  \draw[thick] (X)--(X4) node[pos=0.5,scale=0.2,label=above:{$x_j^1$}] {};
%  \draw[thick] (X4)--(X5) ;
%  \draw[thick] (X4)--(X6);
%  \draw[thick] (X4)--(X7) node[pos=0.5,scale=0.2,label=right:{}] {};

% \node[obs]                   (x)      {$x$} ; %
%  %\node[latent, above=of T]    (theta)  {$\theta$}; %
%%\node[const, above=of x] (f) {};
%  \node[latent, above=of x]    (z)      {$z$} ; %
%  \node[const, left=of z] (a0) {$\alpha_0$};
%
%\edge {z}{x};
%\edge {a0}{z};
%

%  \plate {plate1} { (x) } {$N$}; %
 
%  % More nodes
%  \factoredge {x}  {z}     {x} ; %
% % Define nodes
%  \node[obs]                               (y) {$y$};
%  \node[latent, above=of y, xshift=-1.2cm] (w) {$\mathbf{w}$};
%  \node[latent, above=of y, xshift=1.2cm]  (x) {$\mathbf{x}$};
%  \node[latent, right=2cm of y]            (t) {$\tau$};
%
%  % Connect the nodes
%  \edge {x,w,t} {y} ; %
%
%  % Plates
%  \plate {yx} {(x)(y)} {$N$} ;
%  \plate {} {(w)(y)(yx.north west)(yx.south west)} {$M$} ;

 
 
  
\end{tikzpicture}
